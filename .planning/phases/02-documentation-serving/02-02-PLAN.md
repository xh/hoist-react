---
phase: 02-documentation-serving
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - mcp/resources/docs.ts
  - mcp/tools/docs.ts
  - mcp/server.ts
  - mcp/resources/placeholder.ts
  - mcp/tools/placeholder.ts
autonomous: false

must_haves:
  truths:
    - "LLM can list all available docs via resource listing or list-docs tool"
    - "LLM can read any individual document by ID via the hoist://docs/{docId} resource template"
    - "LLM can search across all docs by keyword via the search-docs tool"
    - "LLM can filter doc listing and search by category (package, concept, devops, conventions)"
    - "Static resources for doc index and conventions are directly addressable"
    - "Placeholder tool and resource from Phase 1 are replaced with real implementations"
  artifacts:
    - path: "mcp/resources/docs.ts"
      provides: "MCP resource registrations for doc index, conventions, and all docs by ID"
      exports: ["registerDocResources"]
    - path: "mcp/tools/docs.ts"
      provides: "MCP tool registrations for search-docs and list-docs"
      exports: ["registerDocTools"]
    - path: "mcp/server.ts"
      provides: "Updated server entry point importing doc resources and tools instead of placeholders"
  key_links:
    - from: "mcp/resources/docs.ts"
      to: "mcp/data/doc-registry.ts"
      via: "import buildRegistry, loadDocContent"
      pattern: "import.*from.*doc-registry"
    - from: "mcp/tools/docs.ts"
      to: "mcp/data/doc-registry.ts"
      via: "import buildRegistry, searchDocs"
      pattern: "import.*from.*doc-registry"
    - from: "mcp/server.ts"
      to: "mcp/resources/docs.ts, mcp/tools/docs.ts"
      via: "import registerDocResources, registerDocTools"
      pattern: "import.*from.*docs"
---

<objective>
Wire the document registry into MCP resources and tools, replacing Phase 1 placeholders with real documentation serving capabilities.

Purpose: This makes the documentation corpus accessible to LLMs through standard MCP primitives -- resources for reading, tools for searching and listing.

Output: `mcp/resources/docs.ts` (static + template resources), `mcp/tools/docs.ts` (search and list tools), updated `mcp/server.ts`, removed placeholder files.
</objective>

<execution_context>
@/Users/amcclain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amcclain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-documentation-serving/02-RESEARCH.md
@.planning/phases/02-documentation-serving/02-01-SUMMARY.md

Source files to understand existing patterns:
@mcp/server.ts
@mcp/tools/placeholder.ts
@mcp/resources/placeholder.ts
@mcp/data/doc-registry.ts
@mcp/util/paths.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create doc resources and doc tools modules</name>
  <files>mcp/resources/docs.ts, mcp/tools/docs.ts</files>
  <action>
**Create `mcp/resources/docs.ts`:**

Export a function `registerDocResources(server: McpServer): void` that registers:

1. **Static resource: doc-index**
   ```
   server.registerResource(
       'doc-index',
       'hoist://docs/index',
       {
           title: 'Hoist Documentation Index',
           description: 'Complete catalog of all hoist-react documentation with descriptions and key topics. Start here to discover available docs.',
           mimeType: 'text/markdown'
       },
       async (uri) => ({
           contents: [{uri: uri.href, text: loadDocContent(indexEntry), mimeType: 'text/markdown'}]
       })
   );
   ```
   Where `indexEntry` is the registry entry with `id === 'index'`.

2. **Static resource: conventions**
   ```
   server.registerResource(
       'conventions',
       'hoist://docs/conventions',
       {
           title: 'Hoist Coding Conventions (AGENTS.md)',
           description: 'Architecture patterns, code style, key dependencies, and AI assistant guidance for hoist-react development.',
           mimeType: 'text/markdown'
       },
       async (uri) => ({
           contents: [{uri: uri.href, text: loadDocContent(conventionsEntry), mimeType: 'text/markdown'}]
       })
   );
   ```

3. **Resource template: hoist-doc**
   Create a `ResourceTemplate` with URI pattern `hoist://docs/{docId}`:
   - `list` callback: Return all registry entries as resources with uri, name (title), description, mimeType.
   - `complete.docId` callback: Filter registry entries whose `id` starts with the given value, return matching IDs.

   Register with `server.registerResource()`:
   - name: `'hoist-doc'`
   - template: the ResourceTemplate instance
   - config: `{ title: 'Hoist Documentation', description: 'Read any hoist-react doc by ID. Use the list to discover available document IDs.', mimeType: 'text/markdown' }`
   - callback: Look up `variables.docId` in the registry. If not found, throw an error with a helpful message listing available IDs. If found, return `loadDocContent(entry)`.

At the top of the function, call `buildRegistry(resolveRepoRoot())` to build the registry. Store in a local `const registry`.

Import from:
- `@modelcontextprotocol/sdk/server/mcp.js` -- `McpServer`, `ResourceTemplate`
- `../data/doc-registry.js` -- `buildRegistry`, `loadDocContent`
- `../util/paths.js` -- `resolveRepoRoot`
- `../util/logger.js` -- `log`

**IMPORTANT NOTE on doc IDs with slashes:** The `{docId}` URI template variable may contain slashes (e.g. `cmp/grid`). RFC 6570 Level 1 templates do NOT match slashes in simple `{var}` expressions. Use `{+docId}` (reserved expansion) in the URI template to allow slashes: `hoist://docs/{+docId}`. Verify by checking the SDK's UriTemplate implementation -- if `{+docId}` is not supported, use an alternative approach: encode slashes in doc IDs as double-hyphens (e.g., `cmp--grid`) and decode in the handler. Document whichever approach is used.

Actually, check the SDK first. The `ResourceTemplate` constructor takes a `string | UriTemplate`. If the SDK's UriTemplate supports `{+var}` (RFC 6570 Level 2+), use that. If not, use the simpler approach: make all doc IDs slash-free by replacing `/` with `--` in the registry ID (e.g., `cmp--grid` instead of `cmp/grid`). Keep consistency -- use the same ID format in resources and tools.

**Create `mcp/tools/docs.ts`:**

Export a function `registerDocTools(server: McpServer): void` that registers:

1. **Tool: hoist-search-docs**
   - title: `'Search Hoist Documentation'`
   - description: `'Search across all hoist-react documentation by keyword. Returns matching documents with context snippets showing where terms appear. Use this to find relevant docs when you do not know the exact document name.'`
   - inputSchema: `z.object({...})` with:
     - `query: z.string().describe('Search keywords (e.g. "grid column sorting", "authentication OAuth")')`
     - `category: z.enum(['package', 'concept', 'devops', 'conventions', 'all']).optional().describe('Filter results to a specific category. Default: all')`
     - `limit: z.number().min(1).max(20).optional().describe('Maximum number of results. Default: 10')`
   - annotations: `{ readOnlyHint: true, destructiveHint: false, idempotentHint: true, openWorldHint: false }`
   - Handler: call `searchDocs(registry, query, {category, limit: limit ?? 10})`, format results as text.

   Format search results as a readable text block:
   ```
   Found N results for "query":

   1. [title] (id: docId, category: cat)
      description
      Matches: N | Snippets:
      - L42: matching line text here...
      - L108: another matching line...

   2. [title] ...
   ```
   If zero results, return "No documents matched your search for 'query'."

2. **Tool: hoist-list-docs**
   - title: `'List Hoist Documentation'`
   - description: `'List all available hoist-react documentation with descriptions and categories. Use this to discover what docs are available before reading specific ones.'`
   - inputSchema: `z.object({...})` with:
     - `category: z.enum(['package', 'concept', 'devops', 'conventions', 'all']).optional().describe('Filter by category. Default: all')`
   - annotations: `{ readOnlyHint: true, destructiveHint: false, idempotentHint: true, openWorldHint: false }`
   - Handler: filter registry by category (if provided and not 'all'), format as text list.

   Format doc list as:
   ```
   Hoist Documentation (N documents):

   ## Package Documentation (M docs)
   - core: Foundation classes defining Hoist's component, model, and service architecture
   - cmp/grid: Primary data grid built on ag-Grid
   ...

   ## Concept Documentation (M docs)
   ...

   ## DevOps Documentation (M docs)
   ...

   Read any document using its ID with the hoist://docs/{id} resource.
   ```

At the top of the function, call `buildRegistry(resolveRepoRoot())`.

**Also include the hoist-ping tool** in this file -- it's useful for connectivity testing. Register it alongside the doc tools so the placeholder file can be deleted in Task 2.

Import from:
- `@modelcontextprotocol/sdk/server/mcp.js` -- `McpServer`
- `zod` -- `z`
- `../data/doc-registry.js` -- `buildRegistry`, `searchDocs`, `DocCategory`
- `../util/paths.js` -- `resolveRepoRoot`
  </action>
  <verify>
1. `npx tsc --project mcp/tsconfig.json --noEmit` passes cleanly (note: placeholder files still exist and server.ts still imports them -- that's fine, this task only creates new files).
2. Verify both files exist: `ls mcp/resources/docs.ts mcp/tools/docs.ts`
3. Verify exports: `grep -n 'export' mcp/resources/docs.ts mcp/tools/docs.ts`
  </verify>
  <done>
- `mcp/resources/docs.ts` exists and exports `registerDocResources` with doc-index, conventions, and hoist-doc template resources
- `mcp/tools/docs.ts` exists and exports `registerDocTools` with hoist-search-docs, hoist-list-docs, and hoist-ping tools
- Both files type-check cleanly
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire doc modules into server and remove placeholders</name>
  <files>mcp/server.ts, mcp/resources/placeholder.ts, mcp/tools/placeholder.ts</files>
  <action>
**Update `mcp/server.ts`:**

Replace placeholder imports with doc imports:
```typescript
import {registerDocResources} from './resources/docs.js';
import {registerDocTools} from './tools/docs.js';
```

Call `registerDocResources(server)` and `registerDocTools(server)` instead of the placeholder registration functions.

Remove the old imports:
```typescript
// DELETE these lines:
import {registerPlaceholderResources} from './resources/placeholder.js';
import {registerPlaceholderTools} from './tools/placeholder.js';
```

And remove the old calls:
```typescript
// DELETE these lines:
registerPlaceholderResources(server);
registerPlaceholderTools(server);
```

**Delete placeholder files:**
- Delete `mcp/resources/placeholder.ts` using `rm`
- Delete `mcp/tools/placeholder.ts` using `rm`

These are fully replaced by the doc-serving modules. The hoist-ping tool was preserved in `mcp/tools/docs.ts` (Task 1).
  </action>
  <verify>
1. `npx tsc --project mcp/tsconfig.json --noEmit` passes cleanly.
2. Start the MCP server and verify it starts without errors: `node --import tsx mcp/server.ts 2>&1 | head -5` (should show the startup log message on stderr, then hang waiting for client).
3. Verify placeholder files are deleted: `ls mcp/resources/placeholder.ts mcp/tools/placeholder.ts` should fail.
4. Verify `mcp/server.ts` imports from docs modules, not placeholders: `grep 'placeholder' mcp/server.ts` should return nothing.
  </verify>
  <done>
- `mcp/server.ts` imports and calls `registerDocResources` and `registerDocTools`
- Placeholder files deleted
- MCP server starts cleanly and type-checks without errors
- No references to placeholder modules remain
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify MCP documentation serving with Claude Code</name>
  <files>none</files>
  <action>
Human verification checkpoint. The MCP server should already be registered with Claude Code from Phase 1. Restart the MCP server to pick up the new tools and resources, then verify in a fresh Claude Code session.
  </action>
  <verify>User confirms all tools and resources work correctly in Claude Code.</verify>
  <done>User has approved that documentation serving works end-to-end via MCP.</done>
  <what-built>Complete documentation serving via MCP -- resources for reading docs by ID, tools for searching and listing docs, static resources for the doc index and coding conventions. Replaces Phase 1 placeholders with real doc-serving capability.</what-built>
  <how-to-verify>
1. Ensure the `.mcp.json` file is configured to point to the MCP server (should already be from Phase 1).
2. In Claude Code, verify the MCP server connects (the hoist-react MCP indicator should show as active).
3. Test the **hoist-ping** tool still works -- invoke it and confirm "Hoist MCP server is running."
4. Test the **hoist-list-docs** tool:
   - Call it with no arguments -- should list all ~30 documents grouped by category.
   - Call it with `category: "package"` -- should list only package docs.
   - Call it with `category: "concept"` -- should list only concept docs.
5. Test the **hoist-search-docs** tool:
   - Search for "grid" -- should find cmp/grid and possibly other docs mentioning grids.
   - Search for "authentication OAuth" -- should find the authentication concept doc.
   - Search for "xyznonexistent" -- should return "No documents matched."
   - Search with `category: "package"` filter -- should only return package docs.
6. Test **reading a document** via the resource:
   - Read `hoist://docs/core` (or equivalent ID) -- should return the full core/README.md content.
   - Read `hoist://docs/conventions` -- should return AGENTS.md content.
   - Read `hoist://docs/index` -- should return docs/README.md content.
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --project mcp/tsconfig.json --noEmit` passes
2. MCP server starts cleanly via `yarn hoist-mcp` or configured `.mcp.json`
3. Claude Code can connect and invoke all tools and read all resources
4. Placeholder files no longer exist
5. No console.log in any MCP code -- only stderr logger
</verification>

<success_criteria>
- LLM can list all docs via hoist-list-docs tool (with optional category filter)
- LLM can search docs via hoist-search-docs tool (keyword + category filter)
- LLM can read any document via hoist://docs/{docId} resource template
- Doc index and conventions are available as static resources
- hoist-ping still works for connectivity testing
- All Phase 1 placeholder code replaced
</success_criteria>

<output>
After completion, create `.planning/phases/02-documentation-serving/02-02-SUMMARY.md`
</output>
