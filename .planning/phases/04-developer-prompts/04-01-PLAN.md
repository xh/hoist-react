---
phase: 04-developer-prompts
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - mcp/prompts/util.ts
  - mcp/prompts/index.ts
  - mcp/server.ts
autonomous: true

must_haves:
  truths:
    - "Prompt utility module provides doc loading and type formatting helpers"
    - "Registration module exports registerPrompts(server) function"
    - "Server.ts calls registerPrompts(server) alongside existing registerDocTools and registerTsTools"
    - "MCP server starts successfully with prompt capability declared"
  artifacts:
    - path: "mcp/prompts/util.ts"
      provides: "Shared prompt utilities for doc loading, section extraction, type formatting"
      exports: ["loadDoc", "extractSection", "formatSymbolSummary", "formatKeyMembers", "hoistConventionsSection"]
    - path: "mcp/prompts/index.ts"
      provides: "Prompt registration entry point"
      exports: ["registerPrompts"]
    - path: "mcp/server.ts"
      provides: "Updated server entry point with prompt registration"
      contains: "registerPrompts"
  key_links:
    - from: "mcp/prompts/util.ts"
      to: "mcp/data/doc-registry.ts"
      via: "buildRegistry and loadDocContent imports"
      pattern: "import.*from.*doc-registry"
    - from: "mcp/prompts/util.ts"
      to: "mcp/data/ts-registry.ts"
      via: "ensureInitialized, getSymbolDetail, getMembers imports"
      pattern: "import.*from.*ts-registry"
    - from: "mcp/prompts/index.ts"
      to: "mcp/prompts/util.ts"
      via: "utility function imports"
      pattern: "import.*from.*util"
    - from: "mcp/server.ts"
      to: "mcp/prompts/index.ts"
      via: "registerPrompts function call"
      pattern: "registerPrompts\\(server\\)"
---

<objective>
Create the shared prompt utilities module and registration scaffold for MCP developer prompts.

Purpose: Establishes the foundation layer that all three developer prompts (grid, form, tabs) will use -- shared helpers for loading documentation, extracting markdown sections, formatting type information, and a conventions block. Also wires the prompt registration into the MCP server entry point.

Output: `mcp/prompts/util.ts` (shared helpers), `mcp/prompts/index.ts` (registration stub), updated `mcp/server.ts`
</objective>

<execution_context>
@/Users/amcclain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amcclain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-developer-prompts/04-RESEARCH.md

# Existing modules this plan integrates with
@mcp/server.ts
@mcp/data/doc-registry.ts
@mcp/data/ts-registry.ts
@mcp/util/paths.ts
@mcp/util/logger.ts
@mcp/tools/docs.ts
@mcp/tools/typescript.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create shared prompt utilities module</name>
  <files>mcp/prompts/util.ts</files>
  <action>
Create `mcp/prompts/util.ts` with the following exports:

1. **`loadDoc(docId: string): string`** -- Load a document's full content by ID from the doc registry. Internally caches the registry instance (built once via `buildRegistry(resolveRepoRoot())`), but loads doc content fresh each call via `loadDocContent(entry)` to avoid stale content (per research Pitfall 2). Returns empty string if doc ID not found.

2. **`extractSection(markdown: string, sectionName: string): string`** -- Extract a named section from markdown content. Matches `## {sectionName}` (or `### {sectionName}`) and returns everything from that header to the next header of equal or higher level. Use a regex approach: match from the section header to the next header of same or higher level, or end of string. Return the content without the header itself, trimmed. Return empty string if section not found.

3. **`formatSymbolSummary(name: string): string`** -- Format a single symbol's detail as a readable markdown block. Calls `ensureInitialized()` then `getSymbolDetail(name)` from ts-registry. Output format (matching the markdown-header style from Phase 3 decisions):
   ```
   ### {name} ({kind})
   Package: {sourcePackage}
   {if extends: "Extends: {extends}"}
   {if jsDoc: "\n{jsDoc}"}

   ```typescript
   {signature}
   ```
   ```
   Returns `"(Symbol '{name}' not found)"` if symbol does not exist.

4. **`formatKeyMembers(symbolName: string, memberNames: string[]): string`** -- Format selected members of a class/interface. Calls `getMembers(symbolName)` from ts-registry. Filters the returned members to only those whose name appears in `memberNames`. Formats each as `- {name}: {type}` (for properties) or `- {name}({params}): {returnType}` (for methods), with JSDoc first line as indented description below. If memberNames is empty or not provided, include all members but cap at 15. Returns the formatted list as a string.

5. **`hoistConventionsSection(): string`** -- Returns a static string block of key Hoist conventions that every prompt should include. Content:
   ```
   ## Key Hoist Conventions
   - Use element factories, NOT JSX: `grid({model})` not `<Grid model={model} />`
   - Models extend HoistModel; mark child models with `@managed`
   - Call `makeObservable(this)` in the constructor
   - Data loading goes in `override async doLoadAsync(loadSpec) { ... }`
   - Use `@bindable` for observable properties that need auto-generated setters
   - Import from `@xh/hoist/...` paths (e.g. `@xh/hoist/cmp/grid`, `@xh/hoist/core`)
   - Use `creates(ModelClass)` in component to create/bind model instance
   - Use `hoistCmp.factory()` to create component factories
   ```

Imports needed:
- `buildRegistry`, `loadDocContent`, `DocEntry` from `../data/doc-registry.js`
- `ensureInitialized`, `getSymbolDetail`, `getMembers` from `../data/ts-registry.js`
- `resolveRepoRoot` from `../util/paths.js`

Cache the doc registry at module level (lazy, built on first call to `loadDoc`). Do NOT cache doc content -- load fresh each time.

Follow the established code style: JSDoc comments on all exports, explicit return types, consistent with doc-registry.ts and ts-registry.ts patterns.
  </action>
  <verify>
Run `npx tsc -p mcp/tsconfig.json --noEmit` and confirm no type errors in the new file. Verify the file exports the 5 expected functions by checking the import map.
  </verify>
  <done>
`mcp/prompts/util.ts` exists with 5 exported functions: `loadDoc`, `extractSection`, `formatSymbolSummary`, `formatKeyMembers`, `hoistConventionsSection`. All type-check cleanly against the existing doc-registry and ts-registry APIs.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create prompt registration module and wire into server</name>
  <files>mcp/prompts/index.ts, mcp/server.ts</files>
  <action>
**Create `mcp/prompts/index.ts`:**

Export a single function `registerPrompts(server: McpServer): void` following the same pattern as `registerDocTools(server)` in `mcp/tools/docs.ts` and `registerTsTools(server)` in `mcp/tools/typescript.ts`.

For now, register 3 stub prompts that will be replaced with full implementations in Plan 02. Each stub should:
- Use `server.registerPrompt()` (NOT the deprecated `server.prompt()` shorthand)
- Include `title`, `description`, and `argsSchema` in the config object
- Return a minimal `GetPromptResult` with a placeholder message

Stub registrations:

1. `'create-grid'` -- title: "Create a Hoist Grid Panel", description: short sentence about generating grid panels with model/columns/data loading, argsSchema: `{ dataFields: z.string().optional().describe('...'), features: z.string().optional().describe('...') }`, callback: return placeholder message.

2. `'create-form'` -- title: "Create a Hoist Form", description: short sentence about generating forms with fields/validation, argsSchema: `{ fields: z.string().optional().describe('...'), validation: z.string().optional().describe('...') }`, callback: return placeholder message.

3. `'create-tab-container'` -- title: "Create a Hoist Tab Container", description: short sentence about generating tabbed interfaces, argsSchema: `{ tabs: z.string().optional().describe('...'), routing: z.string().optional().describe('...') }`, callback: return placeholder message.

End with `log.info('Registered 3 developer prompts');`

Import `McpServer` from `@modelcontextprotocol/sdk/server/mcp.js`, `z` from `zod`, and `log` from `../util/logger.js`.

IMPORTANT naming note from research Pitfall 3: Do NOT prefix prompt names with `hoist-` because the MCP server name (`hoist-react`) already provides that context. In Claude Code they render as `/mcp__hoist-react__create-grid` which is clean. Prefixing would produce the awkward `/mcp__hoist-react__hoist-create-grid`.

**Update `mcp/server.ts`:**

Add `import {registerPrompts} from './prompts/index.js';` alongside the existing imports. Add `registerPrompts(server);` after the existing `registerTsTools(server);` call. Keep the import and call in the same relative position as the other registration modules.
  </action>
  <verify>
1. Run `npx tsc -p mcp/tsconfig.json --noEmit` -- no type errors.
2. Start the MCP server with `npx tsx mcp/server.ts 2>&1 | head -5` and confirm the "Registered 3 developer prompts" log message appears on stderr.
3. Verify the server process starts without crash (check for the "Server started" log message).
  </verify>
  <done>
`mcp/prompts/index.ts` exists and exports `registerPrompts(server)`. `mcp/server.ts` imports and calls `registerPrompts(server)`. Server starts successfully with 3 prompts registered (even if stubs). TypeScript compiles cleanly.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc -p mcp/tsconfig.json --noEmit` passes with zero errors
2. MCP server starts and logs registration of doc resources, doc tools, ts tools, AND 3 developer prompts
3. `mcp/prompts/util.ts` exports are importable from `mcp/prompts/index.ts`
4. Server entry point (`mcp/server.ts`) has exactly 4 registration calls: registerDocResources, registerDocTools, registerTsTools, registerPrompts
</verification>

<success_criteria>
- Prompt utilities module provides working helpers for doc loading, section extraction, and type formatting
- Registration module follows established pattern (registerXxx function called from server.ts)
- Server starts cleanly with prompt capability active
- Foundation is ready for Plan 02 to implement full prompt content
</success_criteria>

<output>
After completion, create `.planning/phases/04-developer-prompts/04-01-SUMMARY.md`
</output>
