---
phase: 01-mcp-server-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - tsconfig.json
  - .npmignore
  - mcp/tsconfig.json
  - mcp/util/logger.ts
autonomous: true

must_haves:
  truths:
    - "MCP dependencies (sdk, zod, tsx) are installed as devDependencies and available for import"
    - "Root tsconfig.json excludes mcp/ from type-checking so Node-only code does not conflict with browser-targeted settings"
    - "mcp/ directory is excluded from npm publishing via .npmignore"
    - "MCP code has its own tsconfig.json targeting Node with ES2022 and Node16 module resolution"
    - "A stderr-only logger utility exists that never writes to stdout"
  artifacts:
    - path: "mcp/tsconfig.json"
      provides: "Node-targeted TypeScript configuration for MCP code"
      contains: "Node16"
    - path: "mcp/util/logger.ts"
      provides: "stderr-only logging utility"
      contains: "console.error"
  key_links:
    - from: "package.json"
      to: "devDependencies"
      via: "@modelcontextprotocol/sdk, zod, tsx entries"
      pattern: "@modelcontextprotocol/sdk"
    - from: "tsconfig.json"
      to: "exclude"
      via: "mcp directory exclusion"
      pattern: "mcp"
---

<objective>
Set up the infrastructure for the Hoist MCP server: install dependencies, configure bundle isolation, and create the MCP-specific TypeScript configuration and logging utility.

Purpose: Establishes the foundation that all MCP server code depends on -- dependencies available, isolation layers in place, and the stderr logger ready for use by the server and all handlers.
Output: Configured project with MCP dependencies, 4-layer isolation (import-chain, tsconfig, npmignore, devDependencies), and a reusable logger utility.
</objective>

<execution_context>
@/Users/amcclain/.claude/get-shit-done/workflows/execute-plan.md
@/Users/amcclain/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-mcp-server-foundation/01-RESEARCH.md
@package.json
@tsconfig.json
@.npmignore
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install MCP dependencies and configure package.json</name>
  <files>package.json</files>
  <action>
Install MCP dependencies as devDependencies:
```bash
yarn add --dev @modelcontextprotocol/sdk zod tsx
```

After installation, manually verify the versions landed in package.json devDependencies. The research recommends `~1.26.0` for the SDK, `^3.25.0` for zod, and `~4.21.0` for tsx -- but use whatever yarn resolves to (these are minimums). Note: zod may already be a transitive dependency; adding it explicitly as a devDependency is correct so we can import it directly.

Add a `bin` field and `hoist-mcp` script to package.json:
```json
{
  "bin": {
    "hoist-mcp": "./bin/hoist-mcp.mjs"
  }
}
```

Add to the existing `scripts` section:
```json
{
  "hoist-mcp": "tsx mcp/server.ts"
}
```

IMPORTANT: Preserve the existing `scripts` entries (`lint`, `lint:all`, `lint:code`, `lint:styles`, `prepare`). Add `hoist-mcp` alongside them.

IMPORTANT: These MUST be `devDependencies`, not `dependencies`. The MCP SDK has substantial transitive deps (express, hono, cors, jose, etc.) that must never leak into browser builds of consuming applications.
  </action>
  <verify>
Run `yarn hoist-mcp --help 2>/dev/null || true` to confirm tsx is installed (will fail since server.ts doesn't exist yet, but should NOT fail with "tsx: command not found").

Verify package.json has all three devDependencies:
```bash
node -e "const p = require('./package.json'); console.log('sdk:', !!p.devDependencies['@modelcontextprotocol/sdk']); console.log('zod:', !!p.devDependencies['zod']); console.log('tsx:', !!p.devDependencies['tsx']); console.log('bin:', !!p.bin?.['hoist-mcp']); console.log('script:', !!p.scripts?.['hoist-mcp']);"
```
All should print `true`.
  </verify>
  <done>package.json has @modelcontextprotocol/sdk, zod, and tsx in devDependencies; has bin.hoist-mcp and scripts.hoist-mcp entries; yarn.lock updated with all transitive dependencies installed.</done>
</task>

<task type="auto">
  <name>Task 2: Configure bundle isolation (tsconfig, npmignore)</name>
  <files>tsconfig.json, .npmignore</files>
  <action>
Update the root `tsconfig.json`: Add `"mcp"` to the existing `exclude` array. The current exclude is `["node_modules", "build"]`. Change it to `["node_modules", "build", "mcp"]`. This prevents the root tsconfig (which targets browser with DOM lib) from type-checking Node-only MCP code.

Update `.npmignore`: Add `mcp` as a new line. This prevents the MCP server directory (a dev tool) from being published to npm. Add it in the "Development tooling directories" section alongside `.claude`, `.github`, etc. Also add `bin` on a separate line since the CLI launcher is also a dev tool not needed by consuming apps.

These changes implement two of the four isolation layers documented in the research:
- Layer 2: tsconfig exclusion (type safety)
- Layer 3: .npmignore exclusion (package safety)

Layer 1 (import-chain separation) is inherent -- no existing hoist-react code will import from mcp/.
Layer 4 (devDependencies) was handled in Task 1.
  </action>
  <verify>
Verify tsconfig.json excludes mcp:
```bash
node -e "const t = require('./tsconfig.json'); console.log('mcp excluded:', t.exclude.includes('mcp'));"
```
Should print `true`.

Verify .npmignore contains mcp:
```bash
grep -c '^mcp$' .npmignore
```
Should print `1`.
  </verify>
  <done>Root tsconfig.json exclude array contains "mcp"; .npmignore contains "mcp" and "bin" entries; all four isolation layers are in place.</done>
</task>

<task type="auto">
  <name>Task 3: Create MCP tsconfig and stderr logger utility</name>
  <files>mcp/tsconfig.json, mcp/util/logger.ts</files>
  <action>
Create `mcp/tsconfig.json` with Node-targeted settings:
```json
{
  "compilerOptions": {
    "target": "ES2022",
    "module": "Node16",
    "moduleResolution": "Node16",
    "esModuleInterop": true,
    "strict": true,
    "skipLibCheck": true,
    "resolveJsonModule": true,
    "outDir": "../build/mcp",
    "rootDir": ".",
    "declaration": false,
    "noEmit": true
  },
  "include": ["./**/*.ts"],
  "exclude": ["node_modules"]
}
```

Key differences from root tsconfig: No DOM lib (Node-only), Node16 module resolution (supports ESM sub-path imports like `@modelcontextprotocol/sdk/server/mcp.js`), strict mode, no composite/declaration (this code is never consumed by other TS projects).

Create `mcp/util/logger.ts`:
```typescript
/**
 * Stderr-only logger for the Hoist MCP server.
 *
 * CRITICAL: All MCP server logging MUST use this utility. The stdout stream is
 * reserved exclusively for JSON-RPC protocol messages -- any non-protocol output
 * on stdout will corrupt the MCP communication channel.
 *
 * Enable debug logging by setting the HOIST_MCP_DEBUG environment variable.
 */
export const log = {
    info: (...args: unknown[]) => console.error('[hoist-mcp]', ...args),
    warn: (...args: unknown[]) => console.error('[hoist-mcp] WARN:', ...args),
    error: (...args: unknown[]) => console.error('[hoist-mcp] ERROR:', ...args),
    debug: (...args: unknown[]) => {
        if (process.env.HOIST_MCP_DEBUG) {
            console.error('[hoist-mcp] DEBUG:', ...args);
        }
    }
};
```

The logger is intentionally simple -- a plain object with four methods, all writing to stderr via console.error(). No class, no abstraction layer, no dependencies. Debug output is gated behind the HOIST_MCP_DEBUG environment variable.
  </action>
  <verify>
Type-check the MCP code with its own tsconfig:
```bash
npx tsc --project mcp/tsconfig.json --noEmit
```
Should succeed with no errors.
  </verify>
  <done>mcp/tsconfig.json exists with Node16 module resolution and no DOM lib; mcp/util/logger.ts exists exporting a log object with info/warn/error/debug methods that all write to stderr via console.error().</done>
</task>

</tasks>

<verification>
1. `node -e "const p = require('./package.json'); const ok = p.devDependencies['@modelcontextprotocol/sdk'] && p.devDependencies['zod'] && p.devDependencies['tsx'] && p.bin['hoist-mcp'] && p.scripts['hoist-mcp']; console.log(ok ? 'PASS' : 'FAIL');"` prints PASS
2. `node -e "const t = require('./tsconfig.json'); console.log(t.exclude.includes('mcp') ? 'PASS' : 'FAIL');"` prints PASS
3. `grep '^mcp$' .npmignore && echo PASS || echo FAIL` prints PASS
4. `npx tsc --project mcp/tsconfig.json --noEmit` exits 0
5. `grep -c 'console.log' mcp/util/logger.ts` prints 0 (no stdout usage)
</verification>

<success_criteria>
- All three MCP devDependencies installed and importable
- package.json has bin field and hoist-mcp script
- Root tsconfig excludes mcp/ directory
- .npmignore excludes mcp/ and bin/ directories
- MCP-specific tsconfig.json targets Node with correct module resolution
- Logger utility writes exclusively to stderr
- MCP code type-checks cleanly with its own tsconfig
</success_criteria>

<output>
After completion, create `.planning/phases/01-mcp-server-foundation/01-01-SUMMARY.md`
</output>
